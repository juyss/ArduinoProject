#include <Arduino.h>
#include <U8g2lib.h>

#include <OneWire.h>
#include <DallasTemperature.h>

// 数据输出脚接开发板数字引脚2
#define ONE_WIRE_BUS 2

OneWire oneWire(ONE_WIRE_BUS);
DallasTemperature sensors(&oneWire);

#ifdef U8X8_HAVE_HW_SPI
#include <SPI.h>
#endif
#ifdef U8X8_HAVE_HW_I2C
#include <Wire.h>
#endif

U8G2_SSD1306_128X64_NONAME_F_4W_SW_SPI u8g2(U8G2_R0, /* clock=*/ 4, /* data=*/ 5, /* cs=*/ 3, /* dc=*/ 6, /* reset=*/ 7);
//// 温(0) 度(1) 是(2)
//static const unsigned char PROGMEM wen[] =
//{ 0x00, 0x00, 0x23, 0xF8, 0x12, 0x08, 0x12, 0x08, 0x83, 0xF8, 0x42, 0x08, 0x42, 0x08, 0x13, 0xF8,
//  0x10, 0x00, 0x27, 0xFC, 0xE4, 0xA4, 0x24, 0xA4, 0x24, 0xA4, 0x24, 0xA4, 0x2F, 0xFE, 0x00, 0x00
//};/*"温",0*/
////
//static const unsigned char PROGMEM du[] =
//{ 0x01, 0x00, 0x00, 0x80, 0x3F, 0xFE, 0x22, 0x20, 0x22, 0x20, 0x3F, 0xFC, 0x22, 0x20, 0x22, 0x20,
//  0x23, 0xE0, 0x20, 0x00, 0x2F, 0xF0, 0x24, 0x10, 0x42, 0x20, 0x41, 0xC0, 0x86, 0x30, 0x38, 0x0E
//};/*"度",1*/
//
//{0x1F,0xF0,0x10,0x10,0x10,0x10,0x1F,0xF0,0x10,0x10,0x10,0x10,0x1F,0xF0,0x00,0x00},
//{0xFF,0xFE,0x01,0x00,0x11,0x00,0x11,0xF8,0x11,0x00,0x29,0x00,0x45,0x00,0x83,0xFE},/*"是",2*/

void setup(void) {
  Serial.begin(9600);
  sensors.begin();
  u8g2.begin();
}

void loop(void) {
  u8g2.setFont(u8g2_font_ncenB10_tr);
  u8g2.clearBuffer();          // clear the internal memory
  u8g2.drawStr(0, 18, "Temperature is: ");
  //    u8g2.drawStr(0,25,str1);
  sensors.requestTemperatures(); // 发送命令获取温度
  float val = sensors.getTempCByIndex(0);
  u8g2.setCursor(0, 33);   //设置光标处
  u8g2.print(val);  //输出内容
  u8g2.setCursor(45, 33);
  u8g2.print("C");
  u8g2.sendBuffer(); // transfer internal memory to the display
  delay(1000);
}
